<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>3D Carousel</title>
<style>
    *{box-sizing:border-box;}
    body{
        font-family:sans-serif;
        text-align:center;
        margin:0;
        background:#fff;
        padding-top: 80px;
        overflow: hidden;
    }

    /* Scene – 3‑D context + grab cursors */
    .scene{
        margin:60px auto;
        width:420px;
        height:300px;
        perspective:1100px;
        position:relative;
        cursor:grab;
        user-select:none;
    }
    .scene.dragging{cursor:grabbing;}

    /* Carousel wrapper */
    .carousel{
        width:100%;height:100%;
        position:absolute;
        transform-style:preserve-3d;
        transition:transform .4s cubic-bezier(.4,0,.2,1);
        user-select:none;
    }

    /* Square cards */
    .carousel__cell{
        position:absolute;
        user-select:none;
        cursor:pointer;
        width:250px;
        height:250px;
        left:50%;top:50%;
        transform:translate(-50%,-50%);
        line-height:200px;
        font-size:96px;
        color:#fff;
        text-align:center;
        transition:transform .35s cubic-bezier(.4,0,.2,1),opacity .35s ease-out;
    }

    .carousel__cell img{
        width:100%;
        height:100%;
        object-fit:cover;
        pointer-events:none;
    }

    .carousel__cell.reflect {
        pointer-events: none;
        opacity: 1;
    }
    
    .carousel__cell.reflect::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(to top, rgba(50, 50, 50, 0) 0%, rgba(255,255,255,1) 67%);
        pointer-events: none;
    }

    /* Control panel */
    .carousel-options{
        margin:40px auto;
        color:#333;
        margin-top: 300px;

    }
    .carousel-options label {
    display: block;
    text-align: left;
    margin-bottom: 15px;
    font-size: 10px;
    color: #ccc;
}

.carousel-options input[type="range"] {
    width: 100%;
    margin-top: 5px;
}
/* Control panel */
.carousel-options{
    margin:40px auto;
    color:#333;
}

.wheel-container {
    position: relative;
    width: 200px;
    height: 200px;
    margin: 250px auto 40px;

    align-items: center;
    justify-content: center;
}

.wheel-inner {
    position: relative;
    width: 140px;
    height: 140px;
    background: #fff;
    border-radius: 50%;
    box-shadow: 
        inset 8px 8px 16px #d9d9d9,
        inset -8px -8px 16px #ffffff;
}

.dial {
    position: absolute !important;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
}

.wheel-display {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 28px;
    color: #333;
    pointer-events: none;
    z-index: 10;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
}

.wheel-buttons {
    position: absolute;
    width: 100%;
    height: 100%;
    pointer-events: none;
}

.wheel-btn {
    position: absolute;
    width: 30px;
    height: 30px;
    background: rgba(255,255,255,0.1);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    color: #666;
    pointer-events: auto;
    cursor: pointer;
    transition: all 0.2s;
    user-select: none;
}

.wheel-btn:hover {
    background: rgba(255,255,255,0.3);
    color: #333;
}

.wheel-btn:active {
    transform: scale(0.95);
}

.btn-menu {
    top: 15px;
    left: 50%;
    transform: translateX(-50%);
}

.btn-forward {
    right: 15px;
    top: 50%;
    transform: translateY(-50%);
}

.btn-backward {
    left: 15px;
    top: 50%;
    transform: translateY(-50%);
}

.btn-play {
    bottom: 15px;
    left: 50%;
    transform: translateX(-50%);
}

/* Parameter sliders */
.parameters-container {
    max-width: 500px;
    margin: 40px auto;
    padding: 20px;
    background: #f5f5f5;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.parameters-container h3 {
    margin-top: 0;
    font-size: 16px;
    font-weight: 600;
    color: #333;
    text-transform: uppercase;
    letter-spacing: 1px;
}


.carousel-options input[type="range"] {
    width: 100%;
    margin-top: 8px;
    height: 2px;
    border-radius: 3px;
    background: #ddd;
    outline: none;
    -webkit-appearance: none;
}

.carousel-options input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 7px;
    height: 7px;
    border-radius: 50%;
    cursor: pointer;
    transition: all 0.2s;
}

.carousel-options input[type="range"]::-webkit-slider-thumb:hover {
    transform: scale(1.2);
}

.carousel-options input[type="range"]::-moz-range-thumb {
    width: 7px;
    height: 7px;
    border-radius: 50%;
    background: #ccc;
    cursor: pointer;
    border: none;
    transition: all 0.2s;
}

.carousel-options input[type="range"]::-moz-range-thumb:hover {
    transform: scale(1.2);
}

.carousel-options span {
    float: right;
}

.carousel_sliders {
    display: flex;
    position: absolute;
    justify-content: space-between;
    width: 100vw;
    padding: 0 20px;
    bottom: 0px;
    margin: auto;
}

</style>
</head>
<body>

    <div class="scene">
        <div class="carousel" id="carousel-container"></div>
    </div>

   <div class="carousel-options">
    <div class="wheel-container">
        <input type="text" class="dial" value="0" data-width="150" data-height="150" 
               data-fgColor="#eee" data-bgColor="#fafafa" data-thickness="0.5" 
               data-min="0" data-max="15" data-displayInput="false" data-cursor="true" data-step="1">
        <!-- <div class="wheel-display">1</div> -->
    </div>
    
    <div class="carousel_sliders">
            <label>
                Cell Size: <span id="cell-size-value">250</span>
                <input id="cell-size-slider" type="range" min="100" max="400" value="250" step="10">
            </label>
            <label>
                Base Gap: <span id="base-gap-value">-30</span>
                <input id="base-gap-slider" type="range" min="-100" max="50" value="-30" step="5">
            </label>
            <label>
                Depth Base: <span id="depth-base-value">-200</span>
                <input id="depth-base-slider" type="range" min="-400" max="0" value="-200" step="10">
            </label>
            <label>
                Depth Step: <span id="depth-step-value">-20</span>
                <input id="depth-step-slider" type="range" min="-50" max="0" value="-20" step="5">
            </label>
    </div>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery-knob@1.2.11/dist/jquery.knob.min.js"></script>

<script>
// Pre-loaded images
const IMAGES = [
    './carousel_scrollwheel/64.jpeg',
    './carousel_scrollwheel/65.jpeg',
    './carousel_scrollwheel/66.jpeg',
    './carousel_scrollwheel/67.jpeg',
    './carousel_scrollwheel/68.jpeg',
    './carousel_scrollwheel/69.jpeg',
    './carousel_scrollwheel/70.jpeg',
    './carousel_scrollwheel/71.jpeg',
    './carousel_scrollwheel/72.jpeg',
    './carousel_scrollwheel/73.jpeg',
    './carousel_scrollwheel/75.jpeg',
    './carousel_scrollwheel/76.jpeg',
    './carousel_scrollwheel/78.jpeg',
    './carousel_scrollwheel/80.jpeg',
    './carousel_scrollwheel/81.jpeg',
    './carousel_scrollwheel/82.jpeg'
];

let carousel3D;


function initCarousel() {
    const carousel = document.getElementById('carousel-container');
    carousel.innerHTML = '';
    
    IMAGES.forEach((imgSrc, index) => {
        const cell = document.createElement('div');
        cell.className = 'carousel__cell';
        
        const img = document.createElement('img');
        img.src = imgSrc;
        img.alt = `Image ${index + 1}`;
        img.draggable = false;
        
        cell.appendChild(img);
        carousel.appendChild(cell);
    });
    
    carousel3D = new Carousel3D();
}

// Carousel 3D Class (from your latest code)
class Carousel3D{
    constructor(){
        this.scene          = document.querySelector('.scene');
        this.carousel       = document.querySelector('.carousel');
        this.cells          = Array.from(document.querySelectorAll('.carousel__cell'))
                                   .filter(el=>!el.classList.contains('reflect'));

        this.reflections = this.cells.map(cell=>{
            const clone = cell.cloneNode(true);
            clone.classList.add('reflect');
            clone.setAttribute('aria-hidden','true');
            this.carousel.appendChild(clone);
            return clone;
        });

        this.cellCount     = 16; // Fixed at 16
        this.selectedIndex = 0;
        this.currentPos    = this.selectedIndex;
        this.isAnimating   = false;

        this.dragging   = false;
        this.dragStartX = 0;

        this.CELL_SIZE   = 250;
        this.BASE_GAP    = -30;
        this.DEPTH_BASE  = -200;
        this.DEPTH_STEP  = -20;

        this.init();
    }

    init(){
        this.cells.forEach((cell,idx)=>cell.addEventListener('click',()=>this.centerCell(idx)));
        this.scene.addEventListener('pointerdown',this.onPointerDown.bind(this));
        this.scene.addEventListener('pointermove',this.onPointerMove.bind(this));
        this.scene.addEventListener('pointerup',  this.onPointerUp.bind(this));
        this.scene.addEventListener('pointerleave',this.onPointerUp.bind(this));

        this.render();
    }

    onPointerDown(e){this.dragging=true;this.dragStartX=e.clientX;this.scene.classList.add('dragging');}
    onPointerMove(e){
        if(!this.dragging)return;
        const dx=e.clientX-this.dragStartX,THRESHOLD=25;
        if(Math.abs(dx)>=THRESHOLD){dx>0?this.rotate('prev'):this.rotate('next');this.dragStartX=e.clientX;}
    }
    onPointerUp(){this.dragging=false;this.scene.classList.remove('dragging');}

    rotate(dir){
        if(this.isAnimating)return;this.isAnimating=true;
        this.selectedIndex=dir==='next'? (this.selectedIndex+1)%this.cells.length
                                       :(this.selectedIndex-1+this.cells.length)%this.cells.length;
        this.currentPos=this.selectedIndex;
        
        // Update the dial
        $('.dial').val(this.selectedIndex).trigger('change');
        
        this.render();
        setTimeout(()=>this.isAnimating=false,350);
    }
    
    centerCell(idx){
        if(this.isAnimating)return;
        this.isAnimating=true;
        this.selectedIndex=idx;
        this.currentPos=idx;
        
        // Update the dial
        $('.dial').val(idx).trigger('change');
        
        this.render();
        setTimeout(()=>this.isAnimating=false,350);
    }
    
    goToIndex(idx){
        this.selectedIndex = Math.round(idx); // Ensure whole number
        this.currentPos = this.selectedIndex;
        this.render();
    }

    render(){
        const visibleRange = 11;
        const center = Math.floor(visibleRange / 2);
        const templates = [];
        
        // Generate exactly 9 templates (positions 0-8)
        for(let i=0; i<visibleRange; i++){
            const o=i-center;
            if(o===0){templates.push({x:0,z:0,rotY:0,opacity:1});}
            else{
                const abs=Math.abs(o);
                const gapFactor=.999*(abs-1);
                const effectiveGap=this.BASE_GAP*gapFactor;
                const sep=this.CELL_SIZE+Math.max(effectiveGap,-.9*this.CELL_SIZE);
                const x=sep*o;
                const z=this.DEPTH_BASE+this.DEPTH_STEP*(abs-1);
                const rotY=(o<0?1:-1)*Math.min(45+(abs-1)*10,70);
                const opacity=(rotY / 1000) +1;
                templates.push({x,z,rotY,opacity});
            }
        }

        this.cells.forEach((cell,i)=>{
            // Calculate distance from selected index with wrapping
            let distance = i - Math.round(this.selectedIndex);
            if(distance > this.cells.length / 2) distance -= this.cells.length;
            if(distance < -this.cells.length / 2) distance += this.cells.length;
            
            const absDistance = Math.abs(distance);
            
            // Only show if within 4 positions of center
            if(absDistance <= 5){
                const tplIndex = distance + center;
                const p=templates[tplIndex];
                cell.style.display='block';
                cell.style.opacity =p.opacity;
                cell.style.transform=`translate(-50%,-50%) translateX(${p.x}px) translateZ(${p.z}px) rotateY(${p.rotY}deg)`;
            }else{
                cell.style.display='none';
            }
        });

        this.reflections.forEach((clone,i)=>{
            let distance = i - Math.round(this.selectedIndex);
            if(distance > this.cells.length / 2) distance -= this.cells.length;
            if(distance < -this.cells.length / 2) distance += this.cells.length;
            
            const absDistance = Math.abs(distance);
            
            if(absDistance <= 4){
                const tplIndex = distance + center;
                const p=templates[tplIndex],drop=this.CELL_SIZE;
                clone.style.display='block';
                clone.style.transform=`translate(-50%,-50%)
                                        translateX(${p.x}px) translateZ(${p.z}px) rotateY(${p.rotY}deg)
                                        translateY(${drop}px) scaleY(-1)`;
            }else{
                clone.style.display='none';
            }
        });
    }
}

// Initialize jQuery Knob with whole numbers only
$(function() {
    $('.dial').knob({
        step: 1,
        change: function(value) {
            const roundedValue = Math.round(value);
            $('.wheel-display').text(roundedValue + 1);
            if(carousel3D && carousel3D.selectedIndex !== roundedValue) {
                carousel3D.goToIndex(roundedValue);
            }
        }
    });
    
    $('.wheel-display').text('1');
    
    // Cell Size Slider
    $('#cell-size-slider').on('input', function() {
        const value = parseInt(this.value);
        $('#cell-size-value').text(value);
        if(carousel3D) {
            carousel3D.CELL_SIZE = value;
            carousel3D.render();
        }
    });
    
    // Base Gap Slider
    $('#base-gap-slider').on('input', function() {
        const value = parseInt(this.value);
        $('#base-gap-value').text(value);
        if(carousel3D) {
            carousel3D.BASE_GAP = value;
            carousel3D.render();
        }
    });
    
    // Depth Base Slider
    $('#depth-base-slider').on('input', function() {
        const value = parseInt(this.value);
        $('#depth-base-value').text(value);
        if(carousel3D) {
            carousel3D.DEPTH_BASE = value;
            carousel3D.render();
        }
    });
    
    // Depth Step Slider
    $('#depth-step-slider').on('input', function() {
        const value = parseInt(this.value);
        $('#depth-step-value').text(value);
        if(carousel3D) {
            carousel3D.DEPTH_STEP = value;
            carousel3D.render();
        }
    });
});

// Initialize on page load
window.addEventListener('DOMContentLoaded', () => {
    initCarousel();
}); 

</script>
</body>
</html>